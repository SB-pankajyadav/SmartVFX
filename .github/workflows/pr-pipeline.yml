name: PR Pipeline - Security Audit

on:
  push:
    branches:
      - main
      - master
      - develop
  pull_request:
    types: [opened, synchronize, reopened]
  workflow_dispatch:

jobs:
  setup:
    name: Setup Workspace
    uses: ./.github/workflows/setup.yml
  
  audit:
    name: Vulnerability Audit
    needs: setup
    uses: ./.github/workflows/audit.yml
  
  pipeline-summary:
    name: Pipeline Summary
    runs-on: ubuntu-latest
    needs: [setup, audit]
    if: always()
    
    steps:
      - name: Check pipeline status
        run: |
          echo "Pipeline execution completed"
          echo "Setup job status: ${{ needs.setup.result }}"
          echo "Audit job status: ${{ needs.audit.result }}"
          
          if [ "${{ needs.setup.result }}" != "success" ]; then
            echo "❌ Setup job failed"
            exit 1
          fi
          
          if [ "${{ needs.audit.result }}" != "success" ]; then
            echo "⚠️ Audit job completed with warnings"
          else
            echo "✅ All jobs completed successfully"
          fi
